<div class="row">
    <div class="col">
        <div class="row">
            <!-- Basic Investigator information form -->
            <form id="basic-info" action="{% url 'basic_info' res.investigator.uuid %}" class="form-group mb-3">
                {% csrf_token %}
                <div class="input-group mb-3">
                    <input id="basic-info-submit" class="btn btn-lg btn-block btn-danger form-control" type="submit"
                        value="Submit">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-name">Name:</span>
                        </div>
                        <input type="text" class="form-control" id="inv-name-inp">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-player">Player:</span>
                        </div>
                        <input type="text" class="form-control" id="inv-player-inp">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-sex">Sex:</span>
                        </div>
                        <select id="inv-sex-inp" class="form-control">
                            <option value="M">Male</option>
                            <option value="F">Female</option>
                        </select>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-age">Age:</span>
                        </div>
                        <input type="text" class="form-control" id="inv-age-inp">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-residence">Residence:</span>
                        </div>
                        <input type="text" class="form-control" id="inv-residence-inp">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-birthplace">Birthplace:</span>
                        </div>
                        <input type="text" class="form-control" id="inv-birthplace-inp">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-occupation">Occupation:</span>
                        </div>
                        <select class="form-control" id="inv-occupation-inp">

                        </select>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-crmin">Credit Rating Min:</span>
                        </div>
                        <input class="form-control" type="text" disabled
                            value={{res.investigator.occupation.credit_rating_min}} aria-describedby="inv-crmin">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="inv-crmax">Credit Rating Max:</span>
                        </div>
                        <input class="form-control" type="text" disabled
                            value={{res.investigator.occupation.credit_rating_max}} aria-describedby="inv-crmax">
                    </div>
                </div>

            </form>
        </div>
    </div>
    {% include "inv_portrait.html" %}
</div>
<script>
    $(document).ready(
        $("#basic-info").on('submit', function (evt) {
            evt.preventDefault();
            var csrftoken = $("[name=csrfmiddlewaretoken]").val();
            $.ajax({
                url: "{% url 'basic_info' res.investigator.uuid %}",
                type: "POST",
                data: {
                    'name': $("#inv-name-inp").val(),
                    'sex': $("#inv-sex-inp").val(),
                    'age': $("#inv-age-inp").val(),
                    'player': $("#inv-player-inp").val(),
                    'residence': $("#inv-residence-inp").val(),
                    'birthplace': $("#inv-birthplace-inp").val(),
                    'occupation': $('#inv-occupation-inp').val()
                },
                beforeSend: function (xhr, settings) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                },
                success: function (res) {
                    let investigator = res.investigator;
                    let occupations = res.occupations;
                    $("#inv-name-inp").val(investigator['name']);
                    $("#inv-sex-inp").val(investigator['sex']);
                    $("#inv-age-inp").val(investigator['age']);
                    $("#inv-birthplace-inp").val(investigator['birthplace']);
                    $("#inv-residence-inp").val(investigator['residence']);
                    $("#inv-player-inp").val(investigator['player']);
                    for (occ of occupations) {
                        if (occ[0] == investigator['occupation']) {
                            $("#inv-occupation-inp").append(
                                `<option value=${occ[0]} selected>${occ[1]}</option>`
                            );
                        } else {
                            $("#inv-occupation-inp").append(
                                `<option value=${occ[0]}>${occ[1]}</option>`
                            );
                        }
                    }
                    $.ajax({
                        url: "{% url 'inv_skills' res.investigator.uuid %}",
                        success: function (res) {
                            $('#skills_1').remove();
                            $('#skills_2').remove();
                            $('#skills_3').remove();
                            let id_ = "#skills_1";
                            for (skill of res.skills) {
                                let full_val = skill[1] < 10 ? "0" + skill[1] : skill[1];
                                let half_val = skill[2] < 10 ? "0" + skill[2] : skill[2];
                                let fifth_val = skill[3] < 10 ? "0" + skill[3] : skill[3];
                                if (res.skills.indexOf(skill) === 0) {
                                    $("#inv-skills").append(
                                        `<div class="col" id="skills_1"></div>`
                                    );
                                } else if (res.skills.indexOf(skill) === 35) {
                                    id_ = "#skills_2";
                                    $("#inv-skills").append(
                                        `<div class="col" id="skills_2"></div>`
                                    );
                                }
                                else if (res.skills.indexOf(skill) === 71) {
                                    id_ = "#skills_3";
                                    $("#inv-skills").append(
                                        `<div class="col" id="skills_3"></div>`
                                    );
                                };
                                $(id_).append(
                                    `
                            <div class="row">
                                <div class="col">
                                    ${skill[0]}:
                                </div >
                                <div style="text-align: right" class="col">
                                    <b>${full_val}</b >|
                                    <b>${half_val}</b > |
                                    <b>${fifth_val}</b>
                                </div >
                            </div >`
                                )
                            }
                        },
                        error: function (res) {
                            console.log(res);
                        }
                    })
                },
                error: function (res) {
                    console.log(res);
                }
            })
        })
    );
    $(document).ready(
        $.ajaxSetup({ cache: false }),
        $("#basic-info").ready(
            $.ajax({
                url: "{% url 'basic_info' res.investigator.uuid %}",
                success: function (res) {
                    let investigator = res.investigator;
                    let occupations = res.occupations;
                    let sexes = $("#inv-sex-inp option");
                    $("#inv-name-inp").val(investigator['name']);
                    $("#inv-age-inp").val(investigator['age']);
                    $("#inv-birthplace-inp").val(investigator['birthplace']);
                    $("#inv-residence-inp").val(investigator['residence']);
                    $("#inv-player-inp").val(investigator['player']);
                    for (sex of sexes) {
                        if (sex.value === investigator['sex']) {
                            sex.selected = true;
                        }
                    }
                    for (occ of occupations) {
                        if (occ[0] == investigator['occupation']) {
                            $("#inv-occupation-inp").append(
                                `<option value=${occ[0]} selected>${occ[1]}</option>`
                            );
                        } else {
                            $("#inv-occupation-inp").append(
                                `<option value=${occ[0]}>${occ[1]}</option>`
                            );
                        }
                    }
                },
                error: function (res) {
                    console.log(res);
                }
            })
        )
    );
</script>

<hr>